# Migration `20191220193212-init`

This migration has been generated by BjornLuG at 12/20/2019, 7:32:12 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."Admin" (
  "hash" text  NOT NULL DEFAULT '' ,
  "id" text  NOT NULL  ,
  "privilege" text  NOT NULL DEFAULT 'BASIC' ,
  "username" text  NOT NULL DEFAULT '' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "public"."Staff" (
  "fullName" text  NOT NULL DEFAULT '' ,
  "hash" text  NOT NULL DEFAULT '' ,
  "id" text  NOT NULL  ,
  "passwordForgotten" boolean  NOT NULL DEFAULT false ,
  "username" text  NOT NULL DEFAULT '' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "public"."Company" (
  "alias" text  NOT NULL DEFAULT '' ,
  "id" text  NOT NULL  ,
  "name" text  NOT NULL DEFAULT '' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "public"."Customer" (
  "active" boolean  NOT NULL DEFAULT true ,
  "addresses" text []   ,
  "code" text  NOT NULL DEFAULT '' ,
  "email" text    ,
  "id" text  NOT NULL  ,
  "name" text  NOT NULL DEFAULT '' ,
  "phoneNumber" text    ,
  "temporary" boolean  NOT NULL DEFAULT false ,
  PRIMARY KEY ("id")
);

CREATE TABLE "public"."Job" (
  "dateIssued" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00' ,
  "id" text  NOT NULL  ,
  "needsFollowUp" boolean  NOT NULL DEFAULT false ,
  PRIMARY KEY ("id")
);

CREATE TABLE "public"."Assignment" (
  "address" text  NOT NULL DEFAULT '' ,
  "checkIn" timestamp(3)    ,
  "checkOut" timestamp(3)    ,
  "id" text  NOT NULL  ,
  "preferTime" timestamp(3)    ,
  PRIMARY KEY ("id")
);

CREATE TABLE "public"."Task" (
  "done" boolean  NOT NULL DEFAULT false ,
  "id" text  NOT NULL  ,
  "remarks" text  NOT NULL DEFAULT '' ,
  "type" text  NOT NULL DEFAULT 'SERVICE' ,
  PRIMARY KEY ("id")
);

CREATE TABLE "public"."Action" (
  "id" text  NOT NULL  ,
  "remarks" text  NOT NULL DEFAULT '' ,
  PRIMARY KEY ("id")
);

ALTER TABLE "public"."Customer" ADD COLUMN "companyBelong" text    REFERENCES "public"."Company"("id") ON DELETE SET NULL,
ADD COLUMN "staffPrimary" text  NOT NULL  REFERENCES "public"."Staff"("id") ON DELETE RESTRICT,
ADD COLUMN "staffSecondary" text    REFERENCES "public"."Staff"("id") ON DELETE SET NULL;

ALTER TABLE "public"."Job" ADD COLUMN "customer" text  NOT NULL  REFERENCES "public"."Customer"("id") ON DELETE RESTRICT;

ALTER TABLE "public"."Assignment" ADD COLUMN "job" text    REFERENCES "public"."Job"("id") ON DELETE SET NULL,
ADD COLUMN "staffPrimary" text  NOT NULL  REFERENCES "public"."Staff"("id") ON DELETE RESTRICT,
ADD COLUMN "staffSecondary" text    REFERENCES "public"."Staff"("id") ON DELETE SET NULL;

ALTER TABLE "public"."Task" ADD COLUMN "assignment" text    REFERENCES "public"."Assignment"("id") ON DELETE SET NULL;

ALTER TABLE "public"."Action" ADD COLUMN "assignment" text    REFERENCES "public"."Assignment"("id") ON DELETE SET NULL;

CREATE UNIQUE INDEX "Admin.username" ON "public"."Admin"("username")

CREATE UNIQUE INDEX "Staff.username" ON "public"."Staff"("username")

CREATE UNIQUE INDEX "Company.name" ON "public"."Company"("name")

CREATE UNIQUE INDEX "Company.alias" ON "public"."Company"("alias")

CREATE UNIQUE INDEX "Customer.code" ON "public"."Customer"("code")

CREATE UNIQUE INDEX "Customer.name" ON "public"."Customer"("name")
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20191220193212-init
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,92 @@
+datasource db {
+  provider = "postgresql"
+  url      = env("DATABASE_URL")
+}
+
+generator photon {
+  provider = "photonjs"
+}
+
+model Admin {
+  id        String         @default(cuid()) @id
+  username  String         @unique
+  privilege AdminPrivilege @default(BASIC)
+  hash      String
+}
+
+model Staff {
+  id                    String       @default(cuid()) @id
+  username              String       @unique
+  fullName              String
+  hash                  String
+  passwordForgotten     Boolean      @default(false)
+  customerPrimaries     Customer[]   @relation("StaffPrimaryByCustomer")
+  customerSecondaries   Customer[]   @relation("StaffSecondaryByCustomer")
+  assignmentPrimaries   Assignment[] @relation("StaffPrimaryByAssignment")
+  assignmentSecondaries Assignment[] @relation("StaffSecondaryByAssignment")
+}
+
+model Company {
+  id    String @default(cuid()) @id
+  name  String @unique
+  alias String @unique
+}
+
+model Customer {
+  id             String    @default(cuid()) @id
+  code           String    @unique
+  name           String    @unique
+  email          String?
+  addresses      String[]
+  phoneNumber    String?
+  companyBelong  Company?
+  temporary      Boolean   @default(false)
+  active         Boolean   @default(true)
+  staffPrimary   Staff     @relation("StaffPrimaryByCustomer")
+  staffSecondary Staff?    @relation("StaffSecondaryByCustomer")
+}
+
+model Job {
+  id            String       @default(cuid()) @id
+  dateIssued    DateTime     @default(now())
+  customer      Customer
+  assignments   Assignment[]
+  needsFollowUp Boolean      @default(false)
+}
+
+model Assignment {
+  id             String    @default(cuid()) @id
+  address        String
+  preferTime     DateTime?
+  checkIn        DateTime?
+  checkOut       DateTime?
+  staffPrimary   Staff     @relation("StaffPrimaryByAssignment")
+  staffSecondary Staff?    @relation("StaffSecondaryByAssignment")
+  tasks          Task[]
+  actions        Action[]
+}
+
+model Task {
+  id      String   @default(cuid()) @id
+  type    TaskType
+  remarks String
+  done    Boolean  @default(false)
+}
+
+model Action {
+  id      String @default(cuid()) @id
+  remarks String
+}
+
+enum AdminPrivilege {
+  FULL
+  BASIC
+}
+
+enum TaskType {
+  SERVICE
+  COMPLAINT
+  DELIVERY
+  TRANSPORT
+  OTHERS
+}
```


