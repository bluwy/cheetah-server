# Migration `20191221142548-rel-cascade`

This migration has been generated by BjornLuG at 12/21/2019, 2:25:48 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."Assignment" DROP COLUMN "job",
ADD COLUMN "job" text  NOT NULL  REFERENCES "public"."Job"("id") ON DELETE RESTRICT;

ALTER TABLE "public"."Task" DROP COLUMN "assignment",
ADD COLUMN "assignment" text  NOT NULL  REFERENCES "public"."Assignment"("id") ON DELETE RESTRICT;

ALTER TABLE "public"."Action" DROP COLUMN "assignment",
ADD COLUMN "assignment" text  NOT NULL  REFERENCES "public"."Assignment"("id") ON DELETE RESTRICT;
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20191220193212-init..20191221142548-rel-cascade
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = env("DATABASE_URL")
 }
 generator photon {
   provider = "photonjs"
@@ -32,19 +32,19 @@
   alias String @unique
 }
 model Customer {
-  id             String    @default(cuid()) @id
-  code           String    @unique
-  name           String    @unique
+  id             String   @default(cuid()) @id
+  code           String   @unique
+  name           String   @unique
   email          String?
   addresses      String[]
   phoneNumber    String?
   companyBelong  Company?
-  temporary      Boolean   @default(false)
-  active         Boolean   @default(true)
-  staffPrimary   Staff     @relation("StaffPrimaryByCustomer")
-  staffSecondary Staff?    @relation("StaffSecondaryByCustomer")
+  temporary      Boolean  @default(false)
+  active         Boolean  @default(true)
+  staffPrimary   Staff    @relation("StaffPrimaryByCustomer")
+  staffSecondary Staff?   @relation("StaffSecondaryByCustomer")
 }
 model Job {
   id            String       @default(cuid()) @id
@@ -63,20 +63,23 @@
   staffPrimary   Staff     @relation("StaffPrimaryByAssignment")
   staffSecondary Staff?    @relation("StaffSecondaryByAssignment")
   tasks          Task[]
   actions        Action[]
+  job            Job       @relation(onDelete: CASCADE)
 }
 model Task {
-  id      String   @default(cuid()) @id
-  type    TaskType
-  remarks String
-  done    Boolean  @default(false)
+  id         String     @default(cuid()) @id
+  type       TaskType
+  remarks    String
+  done       Boolean    @default(false)
+  assignment Assignment @relation(onDelete: CASCADE)
 }
 model Action {
-  id      String @default(cuid()) @id
-  remarks String
+  id         String     @default(cuid()) @id
+  remarks    String
+  assignment Assignment @relation(onDelete: CASCADE)
 }
 enum AdminPrivilege {
   FULL
```


