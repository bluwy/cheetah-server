datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator photon {
  provider = "photonjs"
}

model Admin {
  @@map("admin")
  id        String         @default(cuid()) @id
  username  String         @unique
  privilege AdminPrivilege @default(BASIC)
  hash      String
}

model Staff {
  @@map("staff")
  id                    String       @default(cuid()) @id
  username              String       @unique
  fullName              String       @map("full_name")
  hash                  String
  passwordForgotten     Boolean      @default(false) @map("password_forgotten")
  customerPrimaries     Assignment[] @relation("assignment_staff_primaryTostaff") @map("assignments_assignment_staff_primaryTostaff")
  customerSecondaries   Assignment[] @relation("assignment_staff_secondaryTostaff") @map("assignments_assignment_staff_secondaryTostaff")
  assignmentPrimaries   Customer[]   @relation("customer_staff_primaryTostaff") @map("customers_customer_staff_primaryTostaff")
  assignmentSecondaries Customer[]   @relation("customer_staff_secondaryTostaff") @map("customers_customer_staff_secondaryTostaff")
}

model Company {
  @@map("company")
  id        String     @default(cuid()) @id
  name      String     @unique
  alias     String     @unique
  customers Customer[] @relation(references: [companyBelong])
}

model Customer {
  @@map("customer")
  id             String   @default(cuid()) @id
  code           String   @unique
  name           String   @unique
  email          String?
  addresses      String[]
  phoneNumber    String?  @map("phone_number")
  companyBelong  Company  @map("company_belong")
  temporary      Boolean  @default(false)
  active         Boolean  @default(true)
  staffPrimary   Staff    @relation("customer_staff_primaryTostaff") @map("staff_primary")
  staffSecondary Staff?   @relation("customer_staff_secondaryTostaff") @map("staff_secondary")
  jobs           Job[]    @relation(references: [customer])
}

model Job {
  @@map("job")
  id            String       @default(cuid()) @id
  code          String       @unique
  dateIssued    DateTime     @default(now()) @map("date_issued")
  customer      Customer
  assignments   Assignment[]
  needsFollowUp Boolean?     @map("needs_follow_up")
}

model Assignment {
  @@map("assignment")
  id             String    @default(cuid()) @id
  address        String
  eta            Boolean   @default(false)
  preferTime     DateTime? @map("prefer_time")
  checkIn        DateTime? @map("check_in")
  checkOut       DateTime? @map("check_out")
  expired        Boolean   @default(false)
  staffPrimary   Staff     @relation("assignment_staff_primaryTostaff") @map("staff_primary")
  staffSecondary Staff?    @relation("assignment_staff_secondaryTostaff") @map("staff_secondary")
  tasks          Task[]    @relation(references: [assignment])
  actions        Action[]
  job            Job
}

model Task {
  @@map("task")
  id         String     @default(cuid()) @id
  type       TaskType
  remarks    String
  done       Boolean    @default(false)
  assignment Assignment
}

model Action {
  @@map("action")
  id         String     @default(cuid()) @id
  remarks    String
  assignment Assignment
}

enum AdminPrivilege {
  FULL
  BASIC
}

enum TaskType {
  SERVICE
  COMPLAINT
  DELIVERY
  TRANSPORT
  OTHERS
}